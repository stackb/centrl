# Rust Protobuf Tools

This directory provides protobuf code generation tools for Rust, configured via Cargo and exposed through Bazel.

## Configuration

Tools are declared as dependencies in the root `Cargo.toml`:

```toml
[dependencies]
protoc-gen-tonic = "0.5.0"
protoc-gen-prost = "0.5.0"
protoc-gen-prost-serde = "0.4.0"
```

After adding dependencies, regenerate the lock file:
```bash
cargo update
```

The `@rules_rs` extension automatically makes these available as `@crates//:*__bin` targets.

## Available Tools

### protoc-gen-tonic
Generates Rust gRPC server/client code using the Tonic framework.

### protoc-gen-prost
Generates Rust message structs using Prost.

### protoc-gen-prost-serde
Generates Prost messages with Serde serialization support.

## Usage

### As Proto Plugins (in BUILD files)

```starlark
load("@build_stack_rules_proto//rules:proto_compile.bzl", "proto_compile")

proto_compile(
    name = "my_proto_rust",
    outputs = ["my.rs"],
    plugins = [
        "//bazel_tools/rust:protoc-gen-prost",
        "//bazel_tools/rust:protoc-gen-tonic",
    ],
    proto = ":my_proto",
)
```

### As Binary Tools (command line)

```bash
# Run directly
bazel run //tools:protoc-gen-tonic -- --version
bazel run //tools:protoc-gen-prost -- --help

# Or via bazel_tools
bazel run //bazel_tools/rust:protoc-gen-tonic_bin -- --version
```

## Implementation

The tools are exposed in two ways:

1. **Proto plugins** - `proto_plugin()` rules that wrap the binary for use in `proto_compile()`
2. **Binary aliases** - Direct access to the executables for manual invocation

Both reference the same underlying `@crates//:protoc-gen-*__bin` targets generated by `@rules_rs`.
