"""Tests for semver utilities."""

load(":semver.bzl", "semver_max", "semver_sort")

def _test_semver_max():
    """Test semver_max with various version formats."""
    tests = [
        # (input, expected)
        (["0.0.4", "0.0.5", "0.0.7", "0.0.6", "0.0.9", "0.0.5", "0.0.8", "0.0.8"], "0.0.9"),
        (["1.0.3", "1.2.1", "1.3.0", "1.3.0", "1.2.0", "1.4.2", "1.4.1", "1.5.0", "1.1.1", "1.6.1", "1.7.1"], "1.7.1"),
        (["0.0.3", "0.0.7", "0.0.4", "1.0.0"], "1.0.0"),
        (["0.4.0", "0.10.2", "0.23.0", "0.19.0", "0.31.0", "0.24.0", "0.27.0", "0.35.0"], "0.35.0"),
        (["0.0.1", "0.0.2", "0.0.9", "0.0.6", "0.0.8", "0.0.1", "0.0.9"], "0.0.9"),
        (["20210324.2", "20211102.0", "20211102.0", "20230125.1", "20230802.0.bcr.1"], "20230802.0.bcr.1"),
        (["4.0.0", "6.0.0", "6.3.0", "7.1.0"], "7.1.0"),
        (["0.5.1", "0.5.3", "0.5.3", "0.5.6", "0.6.2", "0.6.2", "0.5.1", "0.5.6"], "0.6.2"),
        (["4.0.0", "5.3.0-21.7", "6.0.0-rc1"], "6.0.0-rc1"),
        (["1.2.11", "1.2.12"], "1.2.12"),
        (["3.19.0", "21.7", "3.19.6", "3.19.2", "21.7", "24.4"], "24.4"),
        (["1.11.0", "1.11.0", "1.12.1", "1.14.0"], "1.14.0"),
        (["4.4.2", "5.2", "5.1"], "5.2"),
        (["0.7.0", "0.7.0", "0.5.1", "0.9.1", "1.0.1"], "1.0.1"),
        (["0.0.0-20220923-a547704"], "0.0.0-20220923-a547704"),
        (["0.33.0", "0.37.0", "0.38.1"], "0.38.1"),
        (["0.27.0", "0.29.0", "0.33.0"], "0.33.0"),
        (["1.4.1", "1.4.2"], "1.4.2"),
        (["6.0.0.1"], "6.0.0.1"),
    ]

    for versions, expected in tests:
        result = semver_max(versions)
        if result != expected:
            fail("semver_max(%s) = %s, expected %s" % (versions, result, expected))

    print("All semver_max tests passed!")

def _test_semver_sort():
    """Test semver_sort."""
    tests = [
        (["1.3.0", "1.2.3", "1.2.4"], ["1.2.3", "1.2.4", "1.3.0"]),
        (["0.0.9", "0.0.5", "0.0.7"], ["0.0.5", "0.0.7", "0.0.9"]),
        (["2.0.0", "1.0.0", "1.5.0"], ["1.0.0", "1.5.0", "2.0.0"]),
    ]

    for versions, expected in tests:
        result = semver_sort(versions)
        if result != expected:
            fail("semver_sort(%s) = %s, expected %s" % (versions, result, expected))

    print("All semver_sort tests passed!")

def run_tests():
    """Run all tests."""
    _test_semver_max()
    _test_semver_sort()
