// ts-proto: Adding a comment to the syntax will become the first
// comment in the output source file.
syntax = "proto3";

package build.stack.bazel.bzlmod.v1;

option go_package = "github.com/stackb/centrl/build/stack/bazel/bzlmod/v1;bzpb";

// Metadata about a Module.
message Metadata {
    message Maintainer {
        // "email": "lperron@google.com",
        string email = 1;
        // "name": "Laurent Perron"
        string name = 2;
        // "github": "UebelAndre",
        string github = 3;
        // "do_not_notify": true,
        bool do_not_notify = 4;
        // "github_user_id": 704767
        int32 github_user_id = 5;
    }
    // "homepage": "https://github.com/mateidavid/zstr",
    string homepage = 1;
    // "maintainers": []
    repeated Maintainer maintainers = 2;
    // "repository": [ "github:mateidavid/zstr" ],
    repeated string repository = 3;
    // "versions": [ "1.0.7" ],
    repeated string versions = 4;
    // "yanked_versions": { "1.5.0": "Regression in prebuilt artifacts leads to missing rules_rust dep" }
    map<string,string> yanked_versions = 5;
    // "deprecated": "use opentracing-cpp instead"
    string deprecated = 6;
}

// Source represents a source.json file for a module version
message Source {
    // URL to the source archive
    string url = 1;
    // Integrity hash (e.g., "sha256-...")
    string integrity = 2;
    // Directory prefix to strip from the archive
    string strip_prefix = 3;
    // Number of leading path components to strip from patch files
    int32 patch_strip = 4;
    // Map of patch file names to their integrity hashes
    map<string, string> patches = 5;
}

// Attestations represents an attestations.json file for a module version
message Attestations {
    // Attestation represents a single attestation entry
    message Attestation {
        // URL to the attestation file
        string url = 1;
        // Integrity hash of the attestation
        string integrity = 2;
    }
    // Media type for the attestations file
    string media_type = 1;
    // Map of file names to their attestations
    map<string, Attestation> attestations = 2;
}

// ModuleVersion represents a Bazel module version and its dependencies
message ModuleVersion {
    // Module name
    string name = 1;
    // Module version
    string version = 2;
    // compat level
    int32 compatibility_level = 3;
    // optional repo_name
    string repo_name = 4;
    // Module dependencies
    repeated ModuleDependency deps = 5;
    // Source information from source.json
    Source source = 6;
    // Attestations information from attestations.json
    Attestations attestations = 7;
}

// ModuleDependency represents a module dependency
message ModuleDependency {
    // Module name
    string name = 1;
    // Module version
    string version = 2;
    // Whether this is a dev dependency
    bool dev = 3;
}
